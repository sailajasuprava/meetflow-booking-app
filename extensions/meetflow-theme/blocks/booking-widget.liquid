<div class="meetflow-booking-widget">
  <h3>Book an appointment</h3>
  <button class="meetflow-btn" id="meetflow-open-modal">Schedule appointment</button>
</div>

<div id="mf-toaster" class="mf-toast" style="display: none;">
  <span class="mf-toast-icon">âœ…</span>
  <span id="mf-toast-message"></span>
</div>

<div id="meetflow-modal" class="mf-modal-overlay" style="display: none;">
  <div class="mf-modal-content">
    <div class="mf-modal-header">
      <div class="mf-header-title">
        <h4><span>ðŸ“… </span>Appointment Test</h4>
      </div>
      <button id="meetflow-close-modal" class="mf-close-btn">&times;</button>
    </div>

    <div class="mf-modal-body">
      <div class="mf-duration">ðŸ•’ 1 hours, 30 minutes</div>
      
      <div class="mf-grid">
        <div class="mf-calendar-side">
          <input type="date" id="mf-date-picker" class="mf-input">
        </div>

        <div class="mf-time-side">
          <p class="mf-day-label" id="mf-selected-day-label">Select a date</p>
          <div class="mf-time-slots" id="mf-slots-container">
            <button class="mf-slot" data-time-range="12:00 AM - 1:30 AM">12:00 AM - 1:30 AM</button>
            <button class="mf-slot" data-time-range="1:00 AM - 2:30 AM">1:00 AM - 2:30 AM</button>
            <button class="mf-slot" data-time-range="2:00 AM - 3:30 AM">2:00 AM - 3:30 AM</button>
            <button class="mf-slot" data-time-range="7:30 PM - 9:00 PM">7:30 PM - 9:00 PM</button>
            <button class="mf-slot" data-time-range="8:30 PM - 10:00 PM">8:30 PM - 10:00 PM</button>
            <button class="mf-slot" data-time-range="9:30 PM - 11:00 PM">9:30 PM - 11:00 PM</button>
          </div>
        </div>
      </div>
    </div>

    <div class="mf-modal-footer">
      <button id="mf-book-now" class="mf-book-btn" disabled>Book now</button>
    </div>
  </div>
</div>

<style>
  /* Existing Styles */
  .meetflow-btn { width: 100%; padding: 14px 20px; font-size: 16px; font-weight: 600; color: #fff; background: #111827; border: none; border-radius: 10px; cursor: pointer; }

  /* Toast Styles */
  .mf-toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #ffffff;
    color: #111827;
    padding: 16px 24px;
    border-radius: 12px;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    border-left: 4px solid #10b981;
    z-index: 2147483647;
    display: flex;
    align-items: center;
    gap: 12px;
    font-weight: 500;
    animation: slideIn 0.3s ease-out;
  }

  @keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
  }

  /* Modal Styles */
  .mf-modal-overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.7); display: none; align-items: center; justify-content: center; z-index: 999999 !important; }
  body.mf-modal-open { overflow: hidden !important; }
  .mf-modal-content { background: #fff; width: 100%; max-width: 850px; max-height: 90vh; border-radius: 12px; overflow-y: auto; position: relative; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); }
  .mf-modal-header { padding: 16px 24px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
  .mf-header-title { display: flex; align-items: center; gap: 10px; color: #0080FF; }
  .mf-close-btn { background: none; border: none; font-size: 24px; cursor: pointer; }
  .mf-modal-body { padding: 24px; }
  .mf-duration { margin-bottom: 20px; font-size: 14px; color: #666; }
  .mf-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
  .mf-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; }
  .mf-time-slots { display: flex; flex-direction: column; gap: 10px; max-height: 300px; overflow-y: auto; }
  .mf-slot { padding: 12px; border: 1px solid #0080FF; background: #fff; color: #0080FF; border-radius: 12px; cursor: pointer; text-align: center; transition: 0.2s; }
  .mf-slot.selected { background: #0080FF; color: #fff; }
  .mf-modal-footer { padding: 16px 24px; border-top: 1px solid #eee; display: flex; justify-content: center; }
  .mf-book-btn { background: #0080FF; color: #fff; padding: 12px 60px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; }
  .mf-book-btn:disabled { background: #ccc; cursor: not-allowed; }

  @media (max-width: 640px) { .mf-grid { grid-template-columns: 1fr; } }
</style>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById('meetflow-modal');
    const toaster = document.getElementById('mf-toaster');
    // Save original toaster position
    const toasterOriginalParent = toaster.parentNode;
    const toasterNextSibling = toaster.nextSibling;

    const toastMsg = document.getElementById('mf-toast-message');
    
    const openBtn = document.getElementById('meetflow-open-modal');
    const closeBtn = document.getElementById('meetflow-close-modal');
    const bookBtn = document.getElementById('mf-book-now');
    const datePicker = document.getElementById('mf-date-picker');
    const slots = document.querySelectorAll('.mf-slot');

    let selectedDate = null;
    let selectedTimeRange = null;

    const originalParent = modal.parentNode;
    const originalNextSibling = modal.nextSibling;

    /* ---------------- OPEN MODAL ---------------- */
    openBtn.addEventListener('click', () => {
      document.body.appendChild(modal);
      modal.style.display = 'flex';
      document.body.classList.add('mf-modal-open');
    });

    /* ---------------- CLOSE MODAL FUNCTION ---------------- */
    const closeModal = () => {
      modal.style.display = 'none';
      document.body.classList.remove('mf-modal-open');
      if (originalNextSibling) {
        originalParent.insertBefore(modal, originalNextSibling);
      } else {
        originalParent.appendChild(modal);
      }
    };

    closeBtn.addEventListener('click', closeModal);

    /* ---------------- SELECTION LOGIC ---------------- */
    datePicker.addEventListener('change', (e) => {
      selectedDate = e.target.value;
      updateButtonState();
    });

    slots.forEach((slot) => {
      slot.addEventListener('click', function () {
        slots.forEach((s) => s.classList.remove('selected'));
        this.classList.add('selected');
        selectedTimeRange = this.getAttribute('data-time-range');
        updateButtonState();
      });
    });

    function updateButtonState() {
      bookBtn.disabled = !(selectedDate && selectedTimeRange);
    }

    /* ---------------- BOOK NOW LOGIC ---------------- */
    bookBtn.addEventListener('click', () => {
      // 1. Format date from YYYY-MM-DD to DD-MM-YYYY
      const dateParts = selectedDate.split('-');
      const formattedDate = `${dateParts[2]}-${dateParts[1]}-${dateParts[0]}`;

      // 2. Set Toast Message
      toastMsg.innerText = `Appointment scheduled on ${formattedDate} from ${selectedTimeRange}`;

      // 3. Close Modal
      closeModal();

      // 4. Show Toaster
      // Move toaster to body (escape stacking context)
      document.body.appendChild(toaster);

      // Show toaster
      toaster.style.display = 'flex';


      // 5. Hide Toaster after 5 seconds
      setTimeout(() => {
      toaster.style.opacity = '0';
      toaster.style.transition = 'opacity 0.5s ease';

      setTimeout(() => {
        toaster.style.display = 'none';
        toaster.style.opacity = '1';

        // Restore toaster back to original DOM position
        if (toasterNextSibling) {
          toasterOriginalParent.insertBefore(toaster, toasterNextSibling);
        } else {
          toasterOriginalParent.appendChild(toaster);
        }
      }, 500);
    }, 5000);

    });
  });
</script>

{% schema %}
{
  "name": "Meetflow Booking Widget",
  "target": "section",
  "settings": []
}
{% endschema %}